<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Note Locker тАФ CryptoJS + Validator.js + FingerprintJS (Single File)</title>

  <!-- Tailwind (CDN) рд╕рд┐рд░реНрдлрд╝ UI рдХреЗ рд▓рд┐рдП -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- CryptoJS (AES/Hash) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js" integrity="sha512-fuV9Wm0YtQ2nqj3mJvZkfhRkY8n+0v6k8t07xQ7mG6B3uGqD7tRDbJkK9Lr0bJ8z1c7qWqn0wGmJfR2KelG1Bw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- validator.js (рдлреЙрд░реНрдо рд╡реИрд▓рд┐рдбреЗрд╢рди) -->
  <script src="https://cdn.jsdelivr.net/npm/validator@13.11.0/validator.min.js"></script>

  <!-- FingerprintJS v3 (рдбрд┐рд╡рд╛рдЗрд╕ рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ) -->
  <script async src="https://openfpcdn.io/fingerprintjs/v3"></script>

  <style>
    /* рдХреБрдЫ subtle custom styles */
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.75);
    }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    .fade-in { animation: fade 0.4s ease-in-out; }
    @keyframes fade { from {opacity:.4; transform: translateY(4px);} to {opacity:1; transform: translateY(0);} }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight">ЁЯФР Secure Note Locker</h1>
      <p class="text-slate-300 mt-1">CryptoJS + Validator.js + FingerprintJS + AJAX (Single File)</p>
    </header>

    <main class="grid lg:grid-cols-5 gap-6 items-start">
      <!-- Left: Form -->
      <section class="lg:col-span-3 glass rounded-2xl shadow-xl p-5 md:p-6 fade-in">
        <h2 class="text-xl font-semibold mb-4">ЁЯУЭ рдЕрдкрдиреА Secure Note рдмрдирд╛рдПрдВ</h2>
        <form id="noteForm" class="space-y-4" autocomplete="off" novalidate>
          <!-- Email -->
          <div>
            <label for="email" class="block text-sm font-medium text-slate-200 mb-1">рдИрдореЗрд▓</label>
            <input id="email" type="email" class="w-full rounded-xl px-3 py-2 bg-slate-900/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="name@example.com"/>
            <p id="emailHelp" class="text-xs text-slate-400 mt-1">рдИрдореЗрд▓ рд╕рд╣реА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (validator.js рд╕реЗ рдЪреЗрдХ)</p>
          </div>

          <!-- Password -->
          <div>
            <label for="password" class="block text-sm font-medium text-slate-200 mb-1">рдкрд╛рд╕рд╡рд░реНрдб</label>
            <input id="password" type="password" class="w-full rounded-xl px-3 py-2 bg-slate-900/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="рдХрдо рд╕реЗ рдХрдо 8 рдЕрдХреНрд╖рд░ + 1 рдирдВрдмрд░ + 1 рд╕реНрдкреЗрд╢рд▓"/>
            <p id="pwdHelp" class="text-xs text-slate-400 mt-1">рдордЬрд╝рдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб рд░рдЦреЗрдВ; рдпрд╣реА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреА рдХреЗ рддреМрд░ рдкрд░ рдпреВрдЬрд╝ рд╣реЛрдЧрд╛ред</p>
          </div>

          <!-- Note -->
          <div>
            <label for="note" class="block text-sm font-medium text-slate-200 mb-1">рдиреЛрдЯ (рдЯреЗрдХреНрд╕реНрдЯ)</label>
            <textarea id="note" rows="6" class="w-full rounded-xl px-3 py-2 bg-slate-900/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="рдпрд╣рд╛рдБ рдЕрдкрдирд╛ рдиреЛрдЯ рд▓рд┐рдЦреЗрдВтАж"></textarea>
            <div class="flex items-center justify-between mt-2">
              <button type="button" id="btnEncrypt" class="rounded-xl px-4 py-2 bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 transition">Encrypt & Save</button>
              <div class="text-xs text-slate-400">рд▓реЛрдХрд▓рд╕реНрдЯреЛрд░реЗрдЬ рдореЗрдВ рдХреЗрд╡рд▓ <em>encrypted</em> рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛрдЧрд╛ред</div>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap gap-2 pt-2">
            <button type="button" id="btnDecrypt" class="rounded-xl px-4 py-2 bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 transition">Decrypt Note</button>
            <button type="button" id="btnCopy" class="rounded-xl px-4 py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-800 transition">Copy Decrypted</button>
            <button type="button" id="btnClear" class="rounded-xl px-4 py-2 bg-rose-600 hover:bg-rose-500 active:bg-rose-700 transition">Clear Storage</button>
            <button type="button" id="btnSync" class="rounded-xl px-4 py-2 bg-teal-600 hover:bg-teal-500 active:bg-teal-700 transition">AJAX Sync</button>
          </div>
        </form>

        <!-- Validation / Status -->
        <div id="status" class="mt-4 text-sm"></div>
      </section>

      <!-- Right: Info / Output -->
      <aside class="lg:col-span-2 space-y-6">
        <div class="glass rounded-2xl shadow-xl p-5 md:p-6 fade-in">
          <h3 class="text-lg font-semibold mb-2">ЁЯЖФ рдбрд┐рд╡рд╛рдЗрд╕ рдлрд╝рд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ</h3>
          <p class="text-sm text-slate-300">FingerprintJS рд╕реЗ рдЬреЗрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдпреВрдирд┐рдХ ID:</p>
          <pre id="fpOut" class="mono bg-slate-900/60 border border-slate-700 rounded-xl p-3 mt-2 text-xs whitespace-pre-wrap break-all">GeneratingтАж</pre>
        </div>

        <div class="glass rounded-2xl shadow-xl p-5 md:p-6 fade-in">
          <h3 class="text-lg font-semibold mb-2">ЁЯФО рдбрд┐рдХреНрд░рд┐рдкреНрдЯреЗрдб рдЖрдЙрдЯрдкреБрдЯ</h3>
          <pre id="out" class="mono bg-slate-900/60 border border-slate-700 rounded-xl p-3 text-sm whitespace-pre-wrap break-words min-h-[120px]">тАФ</pre>
        </div>

        <div class="glass rounded-2xl shadow-xl p-5 md:p-6 fade-in">
          <h3 class="text-lg font-semibold mb-2">ЁЯМР AJAX Response</h3>
          <p class="text-sm text-slate-300">рдбреЗрдореЛ POST: <span class="underline decoration-dotted">https://httpbin.org/post</span></p>
          <pre id="ajaxOut" class="mono bg-slate-900/60 border border-slate-700 rounded-xl p-3 text-xs whitespace-pre-wrap break-all min-h-[120px]">тАФ</pre>
        </div>
      </aside>
    </main>

    <footer class="mt-10 text-center text-xs text-slate-400">
      Made with тЭдя╕П using CryptoJS, Validator.js, FingerprintJS & fetch
    </footer>
  </div>

  <script>
    // -------------------------------
    // Utility Helpers
    // -------------------------------
    const $ = (id) => document.getElementById(id);

    function setStatus(msg, type = "info") {
      const el = $("status");
      const base = "mt-4 text-sm px-3 py-2 rounded-xl border ";
      const color = {
        info:   "bg-slate-900/60 border-slate-700 text-slate-200",
        ok:     "bg-emerald-900/40 border-emerald-700 text-emerald-200",
        warn:   "bg-amber-900/40 border-amber-700 text-amber-200",
        err:    "bg-rose-900/40 border-rose-700 text-rose-200",
      }[type] || color.info;

      el.className = base + color;
      el.textContent = msg;
    }

    function validateEmail(email) {
      return validator.isEmail(email || "");
    }

    function validatePassword(pwd) {
      // рдХрдо рд╕реЗ рдХрдо 8, рдПрдХ рдирдВрдмрд░, рдПрдХ рд╕реНрдкреЗрд╢рд▓
      if (typeof pwd !== "string") return false;
      const longEnough = pwd.length >= 8;
      const hasNum = /\d/.test(pwd);
      const hasSpecial = /[^A-Za-z0-9]/.test(pwd);
      return longEnough && hasNum && hasSpecial;
    }

    function encryptNote(note, password) {
      // AES рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди
      return CryptoJS.AES.encrypt(note, password).toString();
    }

    function decryptNote(cipherText, password) {
      try {
        const bytes = CryptoJS.AES.decrypt(cipherText, password);
        const text = bytes.toString(CryptoJS.enc.Utf8);
        return text || null;
      } catch (e) {
        return null;
      }
    }

    function sha256Hex(text) {
      return CryptoJS.SHA256(text).toString(CryptoJS.enc.Hex);
    }

    // -------------------------------
    // FingerprintJS Init
    // -------------------------------
    let FP_VISITOR_ID = null;

    async function initFingerprint() {
      try {
        // global FingerprintJS loaded from CDN (v3)
        const fp = await FingerprintJS.load({ monitoring: false });
        const result = await fp.get();
        FP_VISITOR_ID = result.visitorId;
        $("fpOut").textContent = FP_VISITOR_ID;
      } catch (err) {
        $("fpOut").textContent = "Fingerprint error: " + err?.message;
      }
    }

    // -------------------------------
    // App Logic
    // -------------------------------
    const LS_KEY = "secure_note_encrypted_v1";
    const LS_META = "secure_note_meta_v1"; // email hash + fp snapshot

    function persist(cipher, meta) {
      localStorage.setItem(LS_KEY, cipher);
      localStorage.setItem(LS_META, JSON.stringify(meta || {}));
    }

    function loadPersisted() {
      return {
        cipher: localStorage.getItem(LS_KEY),
        meta: JSON.parse(localStorage.getItem(LS_META) || "{}"),
      };
    }

    function clearPersisted() {
      localStorage.removeItem(LS_KEY);
      localStorage.removeItem(LS_META);
    }

    async function handleEncrypt() {
      const email = $("email").value.trim();
      const password = $("password").value;
      const note = $("note").value;

      // Validation
      if (!validateEmail(email)) {
        setStatus("рдИрдореЗрд▓ рд╡реИрдз рдирд╣реАрдВ рд╣реИред", "warn");
        return;
      }
      if (!validatePassword(password)) {
        setStatus("рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреНрд░реЙрдиреНрдЧ рдирд╣реАрдВ рд╣реИ (8+, рдирдВрдмрд░, рд╕реНрдкреЗрд╢рд▓).", "warn");
        return;
      }
      if (!note) {
        setStatus("рдХреГрдкрдпрд╛ рдиреЛрдЯ рдЯрд╛рдЗрдк рдХрд░реЗрдВред", "warn");
        return;
      }

      const cipher = encryptNote(note, password);
      const meta = {
        emailHash: sha256Hex(email),
        fp: FP_VISITOR_ID || "(unavailable)",
        ts: new Date().toISOString(),
      };
      persist(cipher, meta);

      $("out").textContent = "Encrypted & saved! (Decrypt рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рдбрд╛рд▓реЗрдВ)";
      setStatus("рдиреЛрдЯ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рд╣реЛрдХрд░ рд▓реЛрдХрд▓рд╕реНрдЯреЛрд░реЗрдЬ рдореЗрдВ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ред", "ok");
    }

    async function handleDecrypt() {
      const password = $("password").value;
      const { cipher } = loadPersisted();

      if (!cipher) {
        setStatus("рдХреЛрдИ рд╕реЗрд╡реНрдб рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдиреЛрдЯ рдирд╣реАрдВ рдорд┐рд▓рд╛ред", "warn");
        $("out").textContent = "тАФ";
        return;
      }
      if (!password) {
        setStatus("рдкрд╣рд▓реЗ рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░реЗрдВред", "warn");
        return;
      }

      const text = decryptNote(cipher, password);
      if (text === null) {
        setStatus("рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдЕрд╕рдлрд▓ тАФ рд╢рд╛рдпрдж рдЧрд▓рдд рдкрд╛рд╕рд╡рд░реНрдбред", "err");
        $("out").textContent = "тАФ";
        return;
      }

      $("out").textContent = text;
      setStatus("рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рд╕рдлрд▓!", "ok");
    }

    async function handleCopy() {
      const text = $("out").textContent;
      if (text && text !== "тАФ") {
        await navigator.clipboard.writeText(text);
        setStatus("рдбрд┐рдХреНрд░рд┐рдкреНрдЯреЗрдб рдиреЛрдЯ рдХреНрд▓рд┐рдкрдмреЛрд░реНрдб рдореЗрдВ рдХреЙрдкреА рд╣реЛ рдЧрдпрд╛ред", "ok");
      } else {
        setStatus("рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВред", "warn");
      }
    }

    function handleClear() {
      clearPersisted();
      $("out").textContent = "тАФ";
      setStatus("рд▓реЛрдХрд▓рд╕реНрдЯреЛрд░реЗрдЬ рдХреНрд▓рд┐рдпрд░ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ред", "ok");
    }

    async function handleSync() {
      const { cipher, meta } = loadPersisted();
      if (!cipher) {
        setStatus("рд╕рд┐рдВрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ Encrypt & Save рдХрд░реЗрдВред", "warn");
        return;
      }
      setStatus("AJAX Sync рдЪрд▓ рд░рд╣рд╛ рд╣реИтАж", "info");

      const payload = {
        encrypted: cipher,
        meta: {
          ...meta,
          fpLive: FP_VISITOR_ID || "(unavailable)",
        },
        // рдбреЗрдореЛ рдХреЗ рд▓рд┐рдП: рд╣реИрд╢реНрдб рдИрдореЗрд▓ рдФрд░ рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ рд╣реА рднреЗрдЬ рд░рд╣реЗ рд╣реИрдВ
      };

      try {
        // Demo endpoint: httpbin echoes back your POST
        const res = await fetch("https://httpbin.org/post", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json();
        $("ajaxOut").textContent = JSON.stringify({
          status: res.status,
          json: data.json,
          headers: data.headers,
          origin: data.origin
        }, null, 2);

        setStatus("AJAX Sync рд╕рдлрд▓! (рдбреЗрдореЛ рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рджреЗрдЦреЗрдВ)", "ok");
      } catch (err) {
        $("ajaxOut").textContent = "AJAX Error: " + (err?.message || String(err));
        setStatus("AJAX рд╡рд┐рдлрд▓ тАФ рд╢рд╛рдпрдж рдЗрдВрдЯрд░рдиреЗрдЯ/рдиреЗрдЯрд╡рд░реНрдХ рд╕рдорд╕реНрдпрд╛ред", "err");
      }
    }

    // -------------------------------
    // Events
    // -------------------------------
    $("btnEncrypt").addEventListener("click", handleEncrypt);
    $("btnDecrypt").addEventListener("click", handleDecrypt);
    $("btnCopy").addEventListener("click", handleCopy);
    $("btnClear").addEventListener("click", handleClear);
    $("btnSync").addEventListener("click", handleSync);

    // рдХреБрдЫ UX рд╣рд┐рдиреНрдЯреНрд╕ рд▓рд╛рдЗрд╡:
    $("email").addEventListener("input", (e) => {
      $("emailHelp").textContent = validateEmail(e.target.value) ? "рдИрдореЗрд▓ рдорд╛рдиреНрдп тЬЕ" : "рдИрдореЗрд▓ рд╕рд╣реА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП";
    });

    $("password").addEventListener("input", (e) => {
      $("pwdHelp").textContent = validatePassword(e.target.value) ? "рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреНрд░реЙрдиреНрдЧ тЬЕ" : "рдХрдо рд╕реЗ рдХрдо 8 рдЕрдХреНрд╖рд░ + 1 рдирдВрдмрд░ + 1 рд╕реНрдкреЗрд╢рд▓";
    });

    // Init on load
    window.addEventListener("load", () => {
      initFingerprint();
      // рдЕрдЧрд░ рдкрд╣рд▓реЗ рд╕реЗ рдбреЗрдЯрд╛ рд╣реИ рддреЛ рдмрддрд╛рдПрдВ
      const { cipher } = loadPersisted();
      if (cipher) {
        setStatus("рдПрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдиреЛрдЯ рдкрд╣рд▓реЗ рд╕реЗ рд╕реЗрд╡реНрдб рд╣реИред рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рдбрд╛рд▓реЗрдВред", "info");
      } else {
        setStatus("рдирдпрд╛ рдиреЛрдЯ рд▓рд┐рдЦреЗрдВ, Encrypt & Save рджрдмрд╛рдПрдБред", "info");
      }
    });
  </script>
</body>
</html>
